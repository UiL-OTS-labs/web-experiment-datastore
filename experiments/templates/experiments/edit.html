{% extends "base/base.html" %}
{% load i18n %}
{% load transformat %}
{% load datatables %}
{% load get_field_name %}

{% block header_title %}
    {% trans 'experiments:edit:header' %} - {{ block.super }}
{% endblock %}

{% block content %}
<style>
 input:read-only {
     background:#efefef;
 }

 .target-group-form {
     margin-top: 2em;
 }
</style>
<div class="uu-inner-container">
    <div class="col-12">
        <h1>
            {% trans 'experiments:edit:header' %}
        </h1>
        <p>
            {% trans 'experiments:edit:info_text' %}
        </p>
        <form method="post">
            {% csrf_token %}
            <table width="100%">
                {{ form.as_table }}
            </table>
            <h3>{% trans 'experiments:edit:target_groups_header' %}</h3>
            {{ target_group_formset.management_form }}
            {% for group_form in target_group_formset %}
                <div class="target-group-form">
                    <table width="100%">
                        {{ group_form.as_table }}
                    </table>
                </div>
            {% endfor %}
            <br/>
            <a href="#" id="add_group">+ {% trans 'experiments:edit:add_group' %}</a>
            <div class="float-right">
                <button type="submit">{% trans 'experiments:globals:save' %}</button>
            </div>
        </form>
    </div>
</div>
<script nonce="{{ request.csp_nonce }}">
 let existingGroups = {{ object.targetgroup_set.count }};
 $('.target-group-form').each((idx, el) => {
     if (idx >= existingGroups) {
         $(el).hide();
     }
 });
 $('#add_group').click((event) => {
     event.preventDefault();
     let hidden = $('.target-group-form:hidden');
     hidden.last().show();

     if (hidden.length - 1 <= 0) {
         $('#add_group').hide();
     }
 });
</script>
{% endblock %}
