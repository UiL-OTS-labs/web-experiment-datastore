{% extends "base/base.html" %}
{% load i18n %}
{% load transformat %}
{% load datatables %}
{% load get_field_name %}
{% load static %}

{% get_current_language as LANGUAGE_CODE %}

{% block header_title %}
    {% trans 'experiments:home:header' %} - {{ block.super }}
{% endblock %}

{% block html_head %}
    {# We need to load pagination manually, as the CSP will block uu-fancy-list from loading it itself #}
    <script src="{% static 'uil.core/js/pagination.js' %}"></script>
    <script src="{% static 'uil.core/js/uu-fancy-list.js' %}"></script>

    <script nonce="{{ request.csp_nonce }}">
        $(function () {
            $('.uu-fancy-list-container').fancyList({
                language: '{{ LANGUAGE_CODE }}',
            });
        });
    </script>
{% endblock %}

{% block content %}
<div class="uu-inner-container">
    <div class="col-12">
        <div class="float-right button button-colored">
            <a href="{% url 'experiments:new' %}">
                {% trans 'experiments:home:create_experiment' %}
            </a>
        </div>
        <h1>
            {% trans 'experiments:home:header' %}
        </h1>
        <p>
            {% trans 'experiments:home:info_text' %}
        </p>
        <div class="uu-fancy-list-container">
            <div class="uu-fancy-list">
                {% for experiment in object_list %}
                    <div class="ufl-item clearfix" data-show="true">
                        <h4>{{ experiment }} </h4>

                        <div class="ufl-undertitle">
                            <div class="ufl-undertitle-line">
                                <a href="{% url 'experiments:detail' experiment.pk %}">
                                    {% trans 'experiments:global:view' %}
                                </a>
                            </div>
                            <div class="ufl-undertitle-line">
                                <a href="{% url 'experiments:edit' experiment.pk %}">
                                    {% trans 'experiments:global:edit' %}
                                </a>
                            </div>
                            <div class="ufl-undertitle-line">
                                <a href="{% url 'experiments:delete_experiment' experiment.pk %}">
                                    {% trans 'experiments:global:delete_experiment' %}
                                </a>
                            </div>
                        </div>

                        <div class="ufl-details">
                            <div class="row">
                                <div class="col-12 col-md-8">

                                    <table>
                                        {% if experiment.approved %}
                                            <tr>
                                                <td>
                                                    {% get_verbose_field_name "experiments" "Experiment" "access_id" %}
                                                </td>

                                                <td>
                                                    {{ experiment.access_id }}
                                                </td>
                                            </tr>
                                        {% endif %}
                                        <tr>
                                            <td>
                                                {% get_verbose_field_name "experiments" "Experiment" "state" %}
                                            </td>
                                            <td>
                                                {# get_state_display gives us the human readable version, instead of the internal integer value #}
                                                {{ experiment.get_state_display }}
                                            </td>
                                        </tr>
                                        {% if experiment.approved %}
                                            <tr>
                                                <td>
                                                    {% trans 'experiments:global:webexp_location' %}
                                                </td>
                                                <td>
                                                    <a href="https://{{ webexp_host }}/{{ experiment.folder_name }}/" target="_blank">
                                                        {{ webexp_host }}/{{ experiment.folder_name }}/
                                                    </a>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    {% trans 'experiments:global:webdav_location' %}
                                                </td>
                                                <td>
                                                    {{ webexp_webdav_host }}/{{ experiment.folder_name }}/ -
                                                    <a href="{% url 'main:help' %}#collapse-webdav">
                                                        Help
                                                    </a>
                                                </td>
                                            </tr>
                                        {% endif %}
                                    </table>

                                </div>

                                <div class="col-12 col-md-4">
                                    {% if experiment.approved %}
                                    <table>
                                        <tr>
                                            <td>
                                                {% trans 'experiments:home:num_datapoints' %}
                                            </td>
                                            <td>
                                                {{ experiment.datapoint_set.count }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <a href="{% url 'experiments:download' experiment.id 'raw' %}" target="_blank">
                                                    {% trans 'experiments:global:download_raw' %}
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <a href="{% url 'experiments:download' experiment.id 'csv' %}" target="_blank">
                                                    {% trans 'experiments:global:download_csv' %}
                                                </a>
                                            </td>
                                        </tr>
                                    </table>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                    </div>
                {% endfor %}
            </div>
        </div>

        <br/>
    </div>
</div>
{% endblock %}