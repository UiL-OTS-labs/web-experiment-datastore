# Generated by Django 3.2.12 on 2022-03-07 14:58
import sys

from django.db import migrations, models
import django.db.models.deletion


def datapoint_set_size(apps, schema_editor):
    """
    Make sure all existing DP's get their size set
    """
    dp_model = apps.get_model("experiments", "DataPoint")
    for dp in dp_model.objects.filter(size=0):
        dp.size = sys.getsizeof(dp.data)
        dp.save()


class Migration(migrations.Migration):

    dependencies = [
        ('experiments', '0013_alter_participantsession_group'),
    ]

    operations = [
        migrations.AddField(
            model_name='datapoint',
            name='size',
            field=models.PositiveBigIntegerField(
                verbose_name='experiments:models:datapoint:size',
                default=0
            ),
            preserve_default=False,
        ),
        migrations.RunPython(
            datapoint_set_size,
            lambda x, y: None,  # Fake reverse func, as the AddField's reverse
            # will reverse this operation anyway
        ),
    ]
