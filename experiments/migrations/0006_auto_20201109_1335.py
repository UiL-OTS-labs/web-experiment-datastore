# Generated by Django 2.2.16 on 2020-11-09 13:35

from django.db import migrations, models


def gen_datapoint_numbers(apps, schema_editor):
    Experiment = apps.get_model('experiments', 'Experiment')
    for experiment in Experiment.objects.all():
        i = 1
        for datapoint in experiment.datapoint_set.all().order_by('date_added'):
            datapoint.number = i
            datapoint.save()
            i += 1


class Migration(migrations.Migration):
    """Part 1 of two-step migration. This one adds the field and sets the
    values."""

    dependencies = [
        ('experiments', '0005_auto_20201007_1137'),
    ]

    operations = [
        migrations.AddField(
            model_name='datapoint',
            name='number',
            field=models.PositiveIntegerField(null=True),
            preserve_default=False,
        ),
        migrations.RunPython(
            gen_datapoint_numbers,
            reverse_code=migrations.RunPython.noop
        )
    ]
